# Milestone v1.1: Voice UX Polish

**Status:** SHIPPED 2026-02-18
**Phases:** 4-7
**Total Plans:** 8

## Overview

v1.1 polished the voice UX — overhauling the filler system, enabling barge-in interruption, adding multi-layer STT filtering, improving tool-use speech flow, and polishing the overlay status system.

## Phases

### Phase 4: Filler System Overhaul
**Goal**: Replace Ollama smart filler generation with non-verbal audio clips managed by a clip factory subprocess that generates, evaluates, and rotates a capped pool of natural-sounding clips
**Depends on**: Nothing (independent)
**Requirements**: FILL-01, FILL-02, FILL-03, FILL-04, FILL-05
**Status**: Complete (2026-02-17)

Plans:
- [x] 04-01-PLAN.md -- Create clip factory daemon with generation, evaluation, and pool rotation
- [x] 04-02-PLAN.md -- Remove smart filler code, simplify filler system, wire clip factory, clean up

### Phase 5: Barge-in
**Goal**: User can interrupt AI mid-speech by speaking, which cancels current TTS playback and queued audio, allowing the conversation to continue naturally
**Depends on**: Nothing (independent)
**Requirements**: BARGE-01, BARGE-02, BARGE-03, BARGE-04
**Status**: Complete (2026-02-17)

Plans:
- [x] 05-01-PLAN.md -- STT gating, VAD detection in STT stage, barge-in trigger with fade-out and cooldown
- [x] 05-02-PLAN.md -- Sentence tracking, interruption context annotation, post-interrupt silence tuning

### Phase 6: Polish & Verification
**Goal**: Verify and tune all pre-work features (STT filtering, tool-use speech suppression, overlay states) end-to-end to ensure they work correctly in real usage
**Depends on**: Phase 4, Phase 5
**Requirements**: STT-01, STT-02, FLOW-01, FLOW-02, OVL-01, OVL-02
**Status**: Complete (2026-02-18)

Plans:
- [x] 06-01-PLAN.md -- Multi-layer Whisper filtering (logprob + compression ratio) and STT rejection flash in overlay
- [x] 06-02-PLAN.md -- Acknowledgment clip factory, gated pre-tool playback, tool intent map, JSON status metadata
- [x] 06-03-PLAN.md -- Dynamic tool-use overlay with intent labels, history enrichment, end-to-end verification

### Phase 7: Nonverbal System Cleanup
**Goal**: Fix broken barge-in trailing filler and remove all orphaned nonverbal filler code/assets left behind when Phase 6 dropped the nonverbal system
**Depends on**: Phase 6 (gap closure from milestone audit)
**Requirements**: FILL-02 (documentation update)
**Status**: Complete (2026-02-18)

Plans:
- [x] 07-01-PLAN.md -- Fix barge-in filler, remove nonverbal generation/assets, update docs

## Execution Order

4 & 5 (parallel) → 6 → 7

## Milestone Summary

**Key Decisions:**
- Acknowledgment phrase fillers instead of nonverbal (Piper TTS can't produce natural hums/breaths)
- STT gating for barge-in instead of mic mute (mic stays live for VAD)
- VAD inline in STT stage, not a separate monitor stage
- 3-layer Whisper filtering (no_speech_prob, avg_logprob, compression_ratio)
- JSON status protocol for tool intent metadata
- Trailing filler on barge-in for natural interruption feel

**Issues Resolved:**
- Ollama smart filler conflicts with LLM response (removed entirely)
- Piper TTS can't produce natural nonverbal interjections (switched to verbal acknowledgments)
- Barge-in trailing filler silently broke when nonverbal system was removed (fixed in Phase 7)
- MCP tool names have prefix that TOOL_INTENT_MAP didn't account for (rsplit fix)
- Ack cancel event lifecycle incomplete (caused stuck tool_use state)

**Technical Debt:**
- VAD sensitivity thresholds need real-world tuning
- STT filtering thresholds need real-noise environment testing
- Acknowledgment clip gate timing needs human perception validation
- Tool intent overlay has ~150ms cosmetic timing window during barge-in
- Current filler system picks randomly without context awareness (v1.2 target)

---

_For current project status, see .planning/PROJECT.md_
